{"filter":false,"title":"workbench_view.1.php","tooltip":"/application/views/workbench_view.1.php","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":416,"column":7},"action":"remove","lines":["<!DOCTYPE html>","<html>","<head>","<meta charset=\"utf-8\">","","<link rel=\"stylesheet\" type=\"text/css\" href=\"https://project-board-css-karchev.c9users.io/css/workbench.css\">","<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js\"></script>","<script src=\"https://d3js.org/d3.v3.min.js\" charset=\"utf-8\"></script>","<script src=\"https://cdn.socket.io/socket.io-1.4.5.js\"></script>","<script src=\"//cdn.temasys.com.sg/adapterjs/0.13.x/adapter.min.js\"></script>","<script src=\"https://project-board-css-karchev.c9users.io/js/dndTree.js\"></script>","<script src=\"https://project-board-css-karchev.c9users.io/js/video-chat.js\"></script>","<script src=\"https://project-board-css-karchev.c9users.io/js/jquery.contextmenu.r2.packed.js\"></script>","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">","<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\"></script>","<script>","\tvar socket = io.connect('https://workbench-node-server-karchev.c9users.io:8080');","    var clientid = 1;","    var nickname = 'nonokia';","    var socketData;","\tvar nodeData;","    var originData;","\tvar root;","\tvar chosenNode;","\tvar treeJSON;","","    $(document).ready(function(){","\t\t// $(\".rootData\").hide();","\t\t//","\t\t// root = JSON.parse($(\".rootData\").text());","\t\t","\t\tapp.initialize();","\t\t","\t\tgetRootData();","\t\t","        treeJSON = tree(root);","","\t\tvar url = document.location.href;","\t\tvar workbenchID = url.substr(url.lastIndexOf(\"/\")+1);","","\t\tsocketData = {\"roomName\" : workbenchID,","\t\t\t\t\t\"rootNode\" : originData};","\t\t\t\t\tsocket.emit('roommake', socketData);","\t\t","\t\tif(workbenchID){","        \tinit(workbenchID);","        }","        ","        ","\t\t","\t\tsocket.on('addNode',function(data){","\t\t\tvar newnodes = tree.nodes(data).reverse();","","\t\t\tvar adjNode;","\t\t\tfunction searchNode(parent, searchFn, childrenFn){","\t\t        if(!parent) return;","","\t\t        if(searchFn(parent)) return;","","\t\t        var children = childrenFn(parent);","\t\t        if(children) {","\t\t            var count = children.length;","\t\t            for(var i = 0; i < count; i++){","\t\t                searchNode(children[i], searchFn, childrenFn);","\t\t            }","\t\t        }","\t\t    }","","\t\t\tsearchNode(root, function(d){","\t\t\t\tif(d.k_num == data.chosenNode){","\t\t\t\t\tadjNode = d;","\t\t\t\t\treturn true;","\t\t\t\t}else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}, function(d) {","\t\t        return d.children && d.children.length > 0 ? d.children : null;","\t\t    });","","            if(adjNode.children && adjNode.children.length > 0)","                adjNode.children.push(newnodes[0]);","            else if(adjNode._children && adjNode._children.length > 0){","                adjNode._children.push(newnodes[0]);","            }","            else if(!adjNode._children && !adjNode.children) {","                adjNode.children = new Array();","                adjNode.children.push(newnodes[0]);","            }","","            treeJSON(adjNode);","\t\t});","","\t\tsocket.on('lockup', function(data){","\t\t\tvar obj = $(\".id_\"+data.nodeID).parent();","\t\t\tconsole.log(obj);","\t\t});","","\t\t$('#keyword').keypress(function(e){","\t\t\tif(e.keyCode == 13 && chosenNode != null){","","\t\t\t\tnodeData = {'roomName': workbenchID,","\t\t\t\t\t\t'name': $(this).val(),","\t\t\t\t\t\t'chosenNode' : chosenNode.k_num,","\t\t\t\t\t\t'parent' : chosenNode.k_num,","\t\t\t\t\t\t'depth' : (parseInt(chosenNode.depth)+1),","\t\t\t\t\t\t'userID' : clientid","\t\t\t\t};","","\t\t\t\tconsole.log(nodeData);","","\t\t\t\t$.ajax({","\t\t\t\t\turl: \"/workbench/insertNode/\",","\t\t\t\t\tdata: nodeData,","\t\t\t\t\tmethod: \"post\",","\t\t\t\t\tdataType: \"json\",","\t\t\t\t\tsuccess: function(data){","\t\t\t\t\t\tnodeData.k_num = data.k_num;","","\t\t\t\t\t\tsocket.emit('keyword',nodeData);","\t\t\t\t\t},","\t\t\t\t\terror: function(){","\t\t\t\t\t\twindow.alert('오류가 발생하였습니다.');","\t\t\t\t\t}","\t\t\t\t});","","\t\t\t}","\t    });","","\t\tsocket.on('deleteNode',function(data){","\t\t\tvar target_Node;","\t\t\tsearchNode(root, function(d){","\t\t\t\tif(d.k_num == data.k_num){","\t\t\t\t\ttarget_Node = d;","\t\t\t\t\treturn true;","\t\t\t\t}else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}, function(d) {","\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;","\t\t\t});","","\t\t\tfor(var i = 0; i < target_Node.children.length ; i++){","\t\t\t\tif(target_Node.children[i].k_num == data.deletedNode){","\t\t\t\t\ttarget_Node.children = target_Node.children.slice(0,i).concat(target_Node.children.slice(i+1));","\t\t\t\t}","\t\t\t}","","\t\t\ttreeJSON(target_Node);","\t\t});","","\t\tsocket.on('lockup', function(data){","\t\t\tvar obj = $(\".id_\"+data.nodeID).parent();","\t\t\tconsole.log(obj);","\t\t});","","\t\t$('rect').contextMenu('myMenu1', {","\t\t\tbindings: {","\t\t\t\t'vote': function(t){","","\t\t\t\t\tvar t_id = t.id.substr(1, t.id.lastIndexOf(\"_\")-1);","\t\t\t\t\tvar t_deleteCheck = t.id.substr(t.id.lastIndexOf(\"_\")+1);","\t\t\t\t\tif(t_deleteCheck == \"start\"){","\t\t\t\t\t\twindow.alert(\"하위 노드가 없어 투표를 할 수 없습니다.\");","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","","\t\t\t\t\tvar target_Node","\t\t\t\t\tsearchNode(root, function(d){","\t\t\t\t\t\tif(d.k_num == t_id){","\t\t\t\t\t\t\ttarget_Node = d;","\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t}else {","\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t}","\t\t\t\t\t}, function(d) {","\t\t\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;","\t\t\t\t\t});","","\t\t\t\t\tvar candidate = new Array();","\t\t\t\t\tcandidate = target_Node.children ? target_Node.children : target_Node._children;","","\t\t\t\t\t$(\".modal-body\").append(\"<form class='vote'></form>\");","\t\t\t\t\tfor(var i = 0 ; i < candidate.length ; i++){","\t\t\t\t\t\t$(\".vote\").append(","\t\t\t\t\t\t\t\"<input type='radio' name='vote' value='\"+candidate[i].name+\"'>\"+candidate[i].name+\"</input></br>\");","\t\t\t\t\t}","","\t\t\t\t\t$(\"#myModal\").modal('toggle');","\t\t\t\t},","\t\t\t\t'delete': function(t){","\t\t\t\t\tconsole.log(t.id);","\t\t\t\t\tvar t_id = t.id.substr(1, t.id.lastIndexOf(\"_\")-1);","\t\t\t\t\tvar t_deleteCheck = t.id.substr(t.id.lastIndexOf(\"_\")+1);","\t\t\t\t\tif(t_deleteCheck == \"end\"){","\t\t\t\t\t\twindow.alert(\"삭제할 수 없는 노드입니다.\");","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","","\t\t\t\t\tif(window.confirm(\"정말 삭제하시겠습니까?\")){","\t\t\t\t\t\tconsole.log(t);","","\t\t\t\t\t\tvar target_Node","\t\t\t\t\t\tsearchNode(root, function(d){","\t\t\t\t\t\t\tif(d.k_num == t_id){","\t\t\t\t\t\t\t\ttarget_Node = d;","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}else {","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}, function(d) {","\t\t\t\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;","\t\t\t\t\t\t});","","\t\t\t\t\t\t$.ajax({","\t\t\t\t\t\t\turl: \"/workbench/deleteNode/\",","\t\t\t\t\t\t\tdata: {\"k_num\" : target_Node.k_num,","\t\t\t\t\t\t\t\t\t\"k_parent\": target_Node.k_parent},","\t\t\t\t\t\t\tmethod: \"post\",","\t\t\t\t\t\t\tsuccess: function(data){","\t\t\t\t\t\t\t\twindow.alert(\"삭제 완료!\");","","\t\t\t\t\t\t\t\tdata = {\"k_num\" : target_Node.k_parent,","\t\t\t\t\t\t\t\t\t\t\"deletedNode\" : target_Node.k_num,","\t\t\t\t\t\t\t\t\t\t\"roomName\" : workbenchID};","\t\t\t\t\t\t\t\tsocket.emit('sendDeleteNode',data);","\t\t\t\t\t\t\t},","\t\t\t\t\t\t\terror: function(){","\t\t\t\t\t\t\t\twindow.alert(\"오류가 발생하였습니다.\");","\t\t\t\t\t\t\t}","\t\t\t\t\t\t});","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","\t\t});","    ","\t\t$(\"#BtnLeave\").click(function(){","\t\t\tsocket.emit('roomleave',1);","","\t\t\tlocation.replace(\"/workbench/\");","\t\t});","    });","","\tfunction searchNode(parent, searchFn, childrenFn){","\t\tif(!parent) return;","","\t\tif(searchFn(parent)) return;","","\t\tvar children = childrenFn(parent);","\t\tif(children) {","\t\t\tvar count = children.length;","\t\t\tfor(var i = 0; i < count; i++){","\t\t\t\tsearchNode(children[i], searchFn, childrenFn);","\t\t\t}","\t\t}","\t}","\t","\tfunction toggleLogSideMenu(){","\t\t$('#logArea').slideToggle();","\t}","\t","\tfunction getRootData(){","\t\t$.ajax({","\t\t\turl:\"https://project-board-css-karchev.c9users.io/workbench/reflesh/15\",","\t\t\tdataType: 'json',","\t\t\tsuccess: function(data){","\t\t\t\toriginData = JSON.stringify(data);","\t\t\t\troot = data;","\t\t\t},","\t\t\terror: function(){","\t\t\t\talert('오류 발생');","\t\t\t}","\t\t});","\t}","</script>","<script>","    var url = document.location.href;","\tvar sttServer = io.connect('https://stt-test-karchev.c9users.io:8080');","\t// 수정 필요","\tsttServer.emit('connected', {'room' : url.substr(url.lastIndexOf(\"/\")+1), 'id' : 'lee' });","\tsttServer.on('broadcast_trancscript', function(e){","\t\tconsole.log(JSON.stringify(e));","\t\tvar time = new Date();","\t\ttime = time.getMonth() + \"/\" + time.getDay() + \" \" + time.getHours() + \":\" + time.getMinutes() + \":\" + time.getSeconds();","\t\tvar finalTranscript = e.transcript;","\t\t$('#logTextArea').val($('#logTextArea').val() + \"[\" + time + \"]\" + \" \" + finalTranscript + \"\\n\");","\t});","\t","\tvar finalTranscript = '';","    var recognizing = false;","\t$('document').ready(function(){","\t\t$('#logArea').hide();","\t\tif (!('webkitSpeechRecognition' in window)) {","              alert(\"당신의 브라우저는 STT 기능을 지원하지 않습니다!\");","        } else{","        \tvar recognition = new webkitSpeechRecognition();","            recognition.continuous = true;         ","            recognition.interimResults = true;     ","            recognition.lang = 'ja';           // 언어 설정","            recognition.onstart = function() {","                recognizing = true;","                $('#start_button').html('STOP');","            };","            ","            recognition.onerror = function(event) {","            \tconsole.log(\"STT 기능 에러 발생\");","            \t$('#start_button').html('다시 시작');","            };","            ","            recognition.onend = function() {","                  console.log('recognition 끝');","                  recognizing = false;","                  $('#instructions').html('&nbsp;');","                  $('#start_button').html('다시 시작');","            };","            ","            recognition.onresult = function(event) {","                  var interimTranscript = '';","                  // Assemble the transcript from the array of results","                  for (var i = event.resultIndex; i < event.results.length; ++i) {","                      if (event.results[i].isFinal) {","                          finalTranscript += event.results[i][0].transcript;","                      } else {","                          interimTranscript += event.results[i][0].transcript;","                      }","                  }","                  console.log(\"interim:  \" + interimTranscript);","                  console.log(\"final:    \" + finalTranscript);","                  // update the page","                  if(finalTranscript.length > 0) {","                  \tvar time = new Date();","\t\t\t\t\ttime = time.getMonth() + \"/\" + time.getDay() + \" \" + time.getHours() + \":\" + time.getMinutes() + \":\" + time.getSeconds();","                    $('#logTextArea').val($('#logTextArea').val() + \"[\" + time + \"]\" + \" \" + finalTranscript + \"\\n\");","                    sttServer.emit('transcriptBroadCast', {'room' : url.substr(url.lastIndexOf(\"/\")+1),'transcript' : finalTranscript});","                    recognition.stop();","                    recognizing = false;","                  }","            };","            ","            $(\"#start_button\").click(function(e) {","                  e.preventDefault();","                  if (recognizing) {","                      recognition.stop();","                      $('#start_button').html('STT START');","                      recognizing = false;","                  } else {","                      finalTranscript = '';","                      // Request access to the User's microphone and Start recognizing voice input","                      recognition.start();","                      $('#start_button').html('waiting');","                      $('#transcript').html('&nbsp;');","                }","        \t});","        }","\t});","</script>","</head>","<body>","\t<div id=\"myModal\" class=\"modal fade\" role=\"dialog\">","  <div class=\"modal-dialog\">","","    <!-- Modal content-->","    <div class=\"modal-content\">","      <div class=\"modal-header\">","        <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>","        <h4 class=\"modal-title\">투표</h4>","      </div>","      <div class=\"modal-body\">","      </div>","      <div class=\"modal-footer\">","        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>","      </div>","    </div>","","  </div>","</div>","\t<nav class=\"navbar navbar-default\">","\t  <div class=\"container\">","\t    <div class=\"navbar-header\">","\t      <a class=\"navbar-brand\" href=\"#\"><script>$('.navbar-brand').html(root.name);</script></a>","\t    </div>","\t    <div class=\"collapse navbar-collapse\" id=\"myNavbar\">","\t      <ul class=\"nav navbar-nav navbar-right\">","\t      \t<li><a href=\"https://project-board-css-karchev.c9users.io\">RETURN</a></li>","\t        <li><a href=\"#\" onclick=\"toggleChatSideMenu()\">VIDEO CHAT</a></li>","\t        <li><a href=\"#\" onclick=\"toggleLogSideMenu()\">CHAT LOG</a></li>","\t      </ul>","\t    </div>","\t  </div>","\t</nav>","    <div class=\"row\">","\t\t<div id=\"tree-container-box\" class=\"container col-xs-10 left-side\">","\t\t\t<div id=\"tree-container\"></div>","\t    \t<div id=\"input-field\">","\t    \t\t<input type=\"text\" id=\"keyword\" size=\"50\" name=\"keyword\" placeholder=\"키워드를 입력하세요\" />","\t    \t\t<button id=\"BtnLeave\">나가기</button>","\t    \t</div>","\t\t</div>","\t\t\t<div class=\"col-xs-2 right-side\">","\t\t\t<div id=\"logArea\">","\t\t\t\t<textarea id=\"logTextArea\"></textarea>","\t\t\t\t<button id=\"start_button\">STT START</button>","\t\t\t</div>","\t\t\t","\t\t</div>","\t\t<div class=\"col-xs-2 right-side\">","\t\t\t<div id=\"videoArea\">","\t\t\t</div>","\t\t</div>","\t</div>","\t<div class=\"contextMenu\" id=\"myMenu1\">","\t\t<ul>","\t\t\t<li id=\"vote\">투표 생성</li>","\t\t\t<li id=\"delete\">노드 삭제</li>","\t\t</ul>","\t</div>","</body>","</html>"],"id":2},{"start":{"row":0,"column":0},"end":{"row":416,"column":7},"action":"insert","lines":["<!DOCTYPE html>","<html>","<head>","<meta charset=\"utf-8\">","","<link rel=\"stylesheet\" type=\"text/css\" href=\"https://project-board-css-karchev.c9users.io/css/workbench.css\">","<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js\"></script>","<script src=\"https://d3js.org/d3.v3.min.js\" charset=\"utf-8\"></script>","<script src=\"https://cdn.socket.io/socket.io-1.4.5.js\"></script>","<script src=\"//cdn.temasys.com.sg/adapterjs/0.13.x/adapter.min.js\"></script>","<script src=\"https://project-board-css-karchev.c9users.io/js/dndTree.js\"></script>","<script src=\"https://project-board-css-karchev.c9users.io/js/video-chat.js\"></script>","<script src=\"https://project-board-css-karchev.c9users.io/js/jquery.contextmenu.r2.packed.js\"></script>","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\">","<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\"></script>","<script>","\tvar socket = io.connect('https://workbench-node-server-karchev.c9users.io:8080');","    var clientid = 1;","    var nickname = 'nonokia';","    var socketData;","\tvar nodeData;","    var originData;","\tvar root;","\tvar chosenNode;","\tvar treeJSON;","","    $(document).ready(function(){","\t\t// $(\".rootData\").hide();","\t\t//","\t\t// root = JSON.parse($(\".rootData\").text());","\t\t","\t\tgetRootData();","\t\t","        treeJSON = tree(root);","","\t\t// var url = document.location.href;","\t\t// var workbenchID = url.substr(url.lastIndexOf(\"/\")+1);","","\t\tvar workbenchID = 15","","\t\tsocketData = {\"roomName\" : workbenchID,","\t\t\t\t\t\"rootNode\" : originData};","\t\t\t\t\tsocket.emit('roommake', socketData);","\t\t","\t\tif(workbenchID){","        \tinit(workbenchID);","        }","        ","        ","\t\t","\t\tsocket.on('addNode',function(data){","\t\t\tvar newnodes = tree.nodes(data).reverse();","","\t\t\tvar adjNode;","\t\t\tfunction searchNode(parent, searchFn, childrenFn){","\t\t        if(!parent) return;","","\t\t        if(searchFn(parent)) return;","","\t\t        var children = childrenFn(parent);","\t\t        if(children) {","\t\t            var count = children.length;","\t\t            for(var i = 0; i < count; i++){","\t\t                searchNode(children[i], searchFn, childrenFn);","\t\t            }","\t\t        }","\t\t    }","","\t\t\tsearchNode(root, function(d){","\t\t\t\tif(d.k_num == data.chosenNode){","\t\t\t\t\tadjNode = d;","\t\t\t\t\treturn true;","\t\t\t\t}else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}, function(d) {","\t\t        return d.children && d.children.length > 0 ? d.children : null;","\t\t    });","","            if(adjNode.children && adjNode.children.length > 0)","                adjNode.children.push(newnodes[0]);","            else if(adjNode._children && adjNode._children.length > 0){","                adjNode._children.push(newnodes[0]);","            }","            else if(!adjNode._children && !adjNode.children) {","                adjNode.children = new Array();","                adjNode.children.push(newnodes[0]);","            }","","            treeJSON(adjNode);","\t\t});","","\t\tsocket.on('lockup', function(data){","\t\t\tvar obj = $(\".id_\"+data.nodeID).parent();","\t\t\tconsole.log(obj);","\t\t});","","\t\t$('#keyword').keypress(function(e){","\t\t\tif(e.keyCode == 13 && chosenNode != null){","","\t\t\t\tnodeData = {'roomName': workbenchID,","\t\t\t\t\t\t'name': $(this).val(),","\t\t\t\t\t\t'chosenNode' : chosenNode.k_num,","\t\t\t\t\t\t'parent' : chosenNode.k_num,","\t\t\t\t\t\t'depth' : (parseInt(chosenNode.depth)+1),","\t\t\t\t\t\t'userID' : clientid","\t\t\t\t};","","\t\t\t\tconsole.log(nodeData);","","\t\t\t\t$.ajax({","\t\t\t\t\turl: \"https://project-board-css-karchev.c9users.io/workbench/insertNode\",","\t\t\t\t\tdata: nodeData,","\t\t\t\t\tmethod: \"post\",","\t\t\t\t\tdataType: \"json\",","\t\t\t\t\tsuccess: function(data){","\t\t\t\t\t\tnodeData.k_num = data.k_num;","","\t\t\t\t\t\tsocket.emit('keyword',nodeData);","\t\t\t\t\t},","\t\t\t\t\terror: function(){","\t\t\t\t\t\twindow.alert('오류가 발생하였습니다.');","\t\t\t\t\t}","\t\t\t\t});","","\t\t\t}","\t    });","","\t\tsocket.on('deleteNode',function(data){","\t\t\tvar target_Node;","\t\t\tsearchNode(root, function(d){","\t\t\t\tif(d.k_num == data.k_num){","\t\t\t\t\ttarget_Node = d;","\t\t\t\t\treturn true;","\t\t\t\t}else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}, function(d) {","\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;","\t\t\t});","","\t\t\tfor(var i = 0; i < target_Node.children.length ; i++){","\t\t\t\tif(target_Node.children[i].k_num == data.deletedNode){","\t\t\t\t\ttarget_Node.children = target_Node.children.slice(0,i).concat(target_Node.children.slice(i+1));","\t\t\t\t}","\t\t\t}","","\t\t\ttreeJSON(target_Node);","\t\t});","","\t\tsocket.on('lockup', function(data){","\t\t\tvar obj = $(\".id_\"+data.nodeID).parent();","\t\t\tconsole.log(obj);","\t\t});","","\t\t$('rect').contextMenu('myMenu1', {","\t\t\tbindings: {","\t\t\t\t'vote': function(t){","","\t\t\t\t\tvar t_id = t.id.substr(1, t.id.lastIndexOf(\"_\")-1);","\t\t\t\t\tvar t_deleteCheck = t.id.substr(t.id.lastIndexOf(\"_\")+1);","\t\t\t\t\tif(t_deleteCheck == \"start\"){","\t\t\t\t\t\twindow.alert(\"하위 노드가 없어 투표를 할 수 없습니다.\");","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","","\t\t\t\t\tvar target_Node","\t\t\t\t\tsearchNode(root, function(d){","\t\t\t\t\t\tif(d.k_num == t_id){","\t\t\t\t\t\t\ttarget_Node = d;","\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t}else {","\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t}","\t\t\t\t\t}, function(d) {","\t\t\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;","\t\t\t\t\t});","","\t\t\t\t\tvar candidate = new Array();","\t\t\t\t\tcandidate = target_Node.children ? target_Node.children : target_Node._children;","","\t\t\t\t\t$(\".modal-body\").append(\"<form class='vote'></form>\");","\t\t\t\t\tfor(var i = 0 ; i < candidate.length ; i++){","\t\t\t\t\t\t$(\".vote\").append(","\t\t\t\t\t\t\t\"<input type='radio' name='vote' value='\"+candidate[i].name+\"'>\"+candidate[i].name+\"</input></br>\");","\t\t\t\t\t}","","\t\t\t\t\t$(\"#myModal\").modal('toggle');","\t\t\t\t},","\t\t\t\t'delete': function(t){","\t\t\t\t\tconsole.log(t.id);","\t\t\t\t\tvar t_id = t.id.substr(1, t.id.lastIndexOf(\"_\")-1);","\t\t\t\t\tvar t_deleteCheck = t.id.substr(t.id.lastIndexOf(\"_\")+1);","\t\t\t\t\tif(t_deleteCheck == \"end\"){","\t\t\t\t\t\twindow.alert(\"삭제할 수 없는 노드입니다.\");","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","","\t\t\t\t\tif(window.confirm(\"정말 삭제하시겠습니까?\")){","\t\t\t\t\t\tconsole.log(t);","","\t\t\t\t\t\tvar target_Node","\t\t\t\t\t\tsearchNode(root, function(d){","\t\t\t\t\t\t\tif(d.k_num == t_id){","\t\t\t\t\t\t\t\ttarget_Node = d;","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}else {","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}, function(d) {","\t\t\t\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;","\t\t\t\t\t\t});","","\t\t\t\t\t\t$.ajax({","\t\t\t\t\t\t\turl: \"https://project-board-css-karchev.c9users.io/workbench/deleteNode\",","\t\t\t\t\t\t\tdata: {\"k_num\" : target_Node.k_num,","\t\t\t\t\t\t\t\t\t\"k_parent\": target_Node.k_parent},","\t\t\t\t\t\t\tmethod: \"post\",","\t\t\t\t\t\t\tsuccess: function(data){","\t\t\t\t\t\t\t\twindow.alert(\"삭제 완료!\");","","\t\t\t\t\t\t\t\tdata = {\"k_num\" : target_Node.k_parent,","\t\t\t\t\t\t\t\t\t\t\"deletedNode\" : target_Node.k_num,","\t\t\t\t\t\t\t\t\t\t\"roomName\" : workbenchID};","\t\t\t\t\t\t\t\tsocket.emit('sendDeleteNode',data);","\t\t\t\t\t\t\t},","\t\t\t\t\t\t\terror: function(){","\t\t\t\t\t\t\t\twindow.alert(\"오류가 발생하였습니다.\");","\t\t\t\t\t\t\t}","\t\t\t\t\t\t});","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","\t\t});","    ","\t\t$(\"#BtnLeave\").click(function(){","\t\t\tsocket.emit('roomleave',1);","","\t\t\tlocation.replace(\"https://project-board-css-karchev.c9users.io/workbench\");","\t\t});","    });","","\tfunction searchNode(parent, searchFn, childrenFn){","\t\tif(!parent) return;","","\t\tif(searchFn(parent)) return;","","\t\tvar children = childrenFn(parent);","\t\tif(children) {","\t\t\tvar count = children.length;","\t\t\tfor(var i = 0; i < count; i++){","\t\t\t\tsearchNode(children[i], searchFn, childrenFn);","\t\t\t}","\t\t}","\t}","\t","\tfunction toggleLogSideMenu(){","\t\t$('#logArea').slideToggle();","\t}","\t","\tfunction getRootData(){","\t\t$.ajax({","\t\t\turl:\"https://project-board-css-karchev.c9users.io/workbench/reflesh/15\",","\t\t\tdataType: 'json',","\t\t\tsuccess: function(data){","\t\t\t\toriginData = JSON.stringify(data);","\t\t\t\troot = data;","\t\t\t},","\t\t\terror: function(){","\t\t\t\talert('오류 발생');","\t\t\t}","\t\t});","\t}","</script>","<script>","    var url = document.location.href;","\tvar sttServer = io.connect('https://stt-test-karchev.c9users.io:8080');","\t// 수정 필요","\tsttServer.emit('connected', {'room' : url.substr(url.lastIndexOf(\"/\")+1), 'id' : 'lee' });","\tsttServer.on('broadcast_trancscript', function(e){","\t\tconsole.log(JSON.stringify(e));","\t\tvar time = new Date();","\t\ttime = time.getMonth() + \"/\" + time.getDay() + \" \" + time.getHours() + \":\" + time.getMinutes() + \":\" + time.getSeconds();","\t\tvar finalTranscript = e.transcript;","\t\t$('#logTextArea').val($('#logTextArea').val() + \"[\" + time + \"]\" + \" \" + finalTranscript + \"\\n\");","\t});","\t","\tvar finalTranscript = '';","    var recognizing = false;","\t$('document').ready(function(){","\t\t$('#logArea').hide();","\t\tif (!('webkitSpeechRecognition' in window)) {","              alert(\"당신의 브라우저는 STT 기능을 지원하지 않습니다!\");","        } else{","        \tvar recognition = new webkitSpeechRecognition();","            recognition.continuous = true;         ","            recognition.interimResults = true;     ","            recognition.lang = 'ja';           // 언어 설정","            recognition.onstart = function() {","                recognizing = true;","                $('#start_button').html('STOP');","            };","            ","            recognition.onerror = function(event) {","            \tconsole.log(\"STT 기능 에러 발생\");","            \t$('#start_button').html('다시 시작');","            };","            ","            recognition.onend = function() {","                  console.log('recognition 끝');","                  recognizing = false;","                  $('#instructions').html('&nbsp;');","                  $('#start_button').html('다시 시작');","            };","            ","            recognition.onresult = function(event) {","                  var interimTranscript = '';","                  // Assemble the transcript from the array of results","                  for (var i = event.resultIndex; i < event.results.length; ++i) {","                      if (event.results[i].isFinal) {","                          finalTranscript += event.results[i][0].transcript;","                      } else {","                          interimTranscript += event.results[i][0].transcript;","                      }","                  }","                  console.log(\"interim:  \" + interimTranscript);","                  console.log(\"final:    \" + finalTranscript);","                  // update the page","                  if(finalTranscript.length > 0) {","                  \tvar time = new Date();","\t\t\t\t\ttime = time.getMonth() + \"/\" + time.getDay() + \" \" + time.getHours() + \":\" + time.getMinutes() + \":\" + time.getSeconds();","                    $('#logTextArea').val($('#logTextArea').val() + \"[\" + time + \"]\" + \" \" + finalTranscript + \"\\n\");","                    sttServer.emit('transcriptBroadCast', {'room' : url.substr(url.lastIndexOf(\"/\")+1),'transcript' : finalTranscript});","                    recognition.stop();","                    recognizing = false;","                  }","            };","            ","            $(\"#start_button\").click(function(e) {","                  e.preventDefault();","                  if (recognizing) {","                      recognition.stop();","                      $('#start_button').html('STT START');","                      recognizing = false;","                  } else {","                      finalTranscript = '';","                      // Request access to the User's microphone and Start recognizing voice input","                      recognition.start();","                      $('#start_button').html('waiting');","                      $('#transcript').html('&nbsp;');","                }","        \t});","        }","\t});","</script>","</head>","<body>","\t<div id=\"myModal\" class=\"modal fade\" role=\"dialog\">","  <div class=\"modal-dialog\">","","    <!-- Modal content-->","    <div class=\"modal-content\">","      <div class=\"modal-header\">","        <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>","        <h4 class=\"modal-title\">투표</h4>","      </div>","      <div class=\"modal-body\">","      </div>","      <div class=\"modal-footer\">","        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>","      </div>","    </div>","","  </div>","</div>","\t<nav class=\"navbar navbar-default\">","\t  <div class=\"container\">","\t    <div class=\"navbar-header\">","\t      <a class=\"navbar-brand\" href=\"#\"><script>$('.navbar-brand').html(root.name);</script></a>","\t    </div>","\t    <div class=\"collapse navbar-collapse\" id=\"myNavbar\">","\t      <ul class=\"nav navbar-nav navbar-right\">","\t      \t<li><a href=\"https://project-board-css-karchev.c9users.io\">RETURN</a></li>","\t        <li><a href=\"#\" onclick=\"toggleChatSideMenu()\">VIDEO CHAT</a></li>","\t        <li><a href=\"#\" onclick=\"toggleLogSideMenu()\">CHAT LOG</a></li>","\t      </ul>","\t    </div>","\t  </div>","\t</nav>","    <div class=\"row\">","\t\t<div id=\"tree-container-box\" class=\"container col-xs-10 left-side\">","\t\t\t<div id=\"tree-container\"></div>","\t    \t<div id=\"input-field\">","\t    \t\t<input type=\"text\" id=\"keyword\" size=\"50\" name=\"keyword\" placeholder=\"키워드를 입력하세요\" />","\t    \t\t<button id=\"BtnLeave\">나가기</button>","\t    \t</div>","\t\t</div>","\t\t\t<div class=\"col-xs-2 right-side\">","\t\t\t<div id=\"logArea\">","\t\t\t\t<textarea id=\"logTextArea\"></textarea>","\t\t\t\t<button id=\"start_button\">STT START</button>","\t\t\t</div>","\t\t\t","\t\t</div>","\t\t<div class=\"col-xs-2 right-side\">","\t\t\t<div id=\"videoArea\">","\t\t\t</div>","\t\t</div>","\t</div>","\t<div class=\"contextMenu\" id=\"myMenu1\">","\t\t<ul>","\t\t\t<li id=\"vote\">투표 생성</li>","\t\t\t<li id=\"delete\">노드 삭제</li>","\t\t</ul>","\t</div>","</body>","</html>"]}],[{"start":{"row":38,"column":22},"end":{"row":38,"column":23},"action":"insert","lines":[";"],"id":5}]]},"ace":{"folds":[],"scrolltop":480,"scrollleft":0,"selection":{"start":{"row":42,"column":41},"end":{"row":42,"column":41},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":33,"state":"js-start","mode":"ace/mode/php"}},"timestamp":1467309112500,"hash":"ac29f4133377764a6e2550ba497d58575dd522d0"}